
# 온도톡(Ondo Talk) - AI 상담사 & 롤플레이 앱 개발 프로젝트

```dart
// 상담기능을 테스트 하고 싶으면 lib/core/service/gemini_counseling_service.dart의 12번째 줄에 있는 api를 제미나이2.0 api로 넣어주세요

class GeminiCounselingService {
  final String _apiKey = '제미나이API를 넣어주세요'; //이부분에 제미나이 2.0 api를 넣어주세요
  final String _geminiApiUrl = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent';
  final bool _testMode = false;
  
  // 테스트 응답
  final String _testResponse = '''안녕하세요. 상담사입니다. 어떻게 도와드릴까요?
오늘 어떤 고민이 있으신가요? 편안하게 말씀해주세요.''';

```
## 목차

1. [기획 및 디자인](#1-기획-및-디자인)
2. [기본 기능 구현](#2-기본-기능-구현)
3. [네비게이션 및 데이터 전달](#3-네비게이션-및-데이터-전달)
4. [고급 기능 통합](#4-고급-기능-통합)
5. [API 및 외부 서비스 연동](#5-api-및-외부-서비스-연동)

---

## 1. 기획 및 디자인

### 1.1 앱 주제 선정 및 기본 기능 정의

- **핵심 컨셉**: '대화의 온도(Ondo)' 프로젝트의 AI 상담 기능을 독립적인 앱으로 구체화
  - 기존프로젝트개요 : [https://github.com/haepada/AIFFEL_quest_cr/blob/main/Flutter/Quest04/REPORT.md]
  - 기존 컨셉인 '대화 온도'를 살려 소통의 따뜻함과 균형을 중시
  - 다양한 페르소나를 가진 AI 상담사와의 대화를 통한 심리적 지원 제공
  - 롤플레이 기능을 통한 대화 연습 및 소통 능력 향상 기회 제공

- **주요 기능 정의**:
  - AI 상담사 선택: 공감형, 분석형, 실용형, 유머형 등 다양한 성격의 AI 상담사
  - 맞춤 대화: 사용자의 질문이나 고민에 대한 AI 상담사의 응답
  - 롤플레이 모드: 면접, 연애, 업무 대화 등 다양한 상황에서의 대화 연습
  - 상담사 커스터마이징: 사용자가 직접 AI 상담사의 성격과 특성을 설정

- **타겟 사용자**:
  - 심리적 지원이 필요한 일반 사용자
  - 의사소통 능력을 향상시키고자 하는 사용자
  - 특정 상황(면접, 발표 등)에 대한 대화 연습이 필요한 사용자

### 1.2 정보구조도 및 와이어프레임 작성

- **정보구조도**:
  ```
  🔵 메인 화면
  ├── 🟢 AI 상담사 목록
  │   ├── 🟡 기본 상담사
  │   │   ├── 🔴 공감형 상담사
  │   │   ├── 🔴 분석형 상담사
  │   │   └── 🔴 기타 기본 상담사
  │   └── 🟡 커스텀 상담사
  │       ├── 🔴 사용자 생성 상담사
  │       └── 🔴 롤플레이 상담사
  ├── 🟢 대화 화면
  │   ├── 🟡 메시지 입력/전송
  │   ├── 🟡 대화 내역 표시
  │   └── 🟡 상담사 정보 표시
  ├── 🟢 상담사 설정
  │   ├── 🟡 일반 상담사 생성
  │   │   ├── 🔴 이름/아바타 설정
  │   │   ├── 🔴 성격 특성 설정
  │   │   └── 🔴 전문 분야 설정
  │   └── 🟡 롤플레이 상담사 생성
  │       ├── 🔴 롤플레이 카테고리 선택
  │       ├── 🔴 시나리오 설정
  │       └── 🔴 컨텍스트 정보 설정
  └── 🟢 설정
      ├── 🟡 테마 설정
      ├── 🟡 접근성 설정
      └── 🟡 앱 정보
  ```

- **와이어프레임 설계**:
  - **메인 화면**: 상담사 카드 목록 형태로 표시, 각 카드는 상담사 아바타와 이름, 간략한 설명 포함
  - **채팅 화면**: 상단에 상담사 정보, 중앙에 대화 내역, 하단에 메시지 입력창 배치
  - **상담사 생성 화면**: 단계별 설정 프로세스, 직관적인 슬라이더와 선택 UI
  - **설정 화면**: 테마, 접근성, 데이터 관리 등 앱 설정 모음

### 1.3 프로토타이핑 도구를 활용한 UI/UX 디자인

- **디자인 프로토타이핑**:
  - **색상 팔레트**: 주요 색상으로 파란색/보라색 계열 사용, 상담사 유형별 그라데이션 컬러 적용
  - **타이포그래피**: 가독성 높은 산세리프 폰트 적용, 크기 계층 구조 명확히 설정
  - **UI 컴포넌트**: 카드 형태의 요소, 둥근 모서리 버튼, 직관적인 아이콘 활용
  - **애니메이션**: 부드러운 전환 효과, 상태 변화를 시각적으로 명확히 표현

- **디자인 원칙**:
  - **일관성**: 전체 앱에 걸쳐 일관된 시각적 언어 사용
  - **단순성**: 불필요한 요소를 제거하고 핵심 기능에 집중
  - **접근성**: 다양한 사용자를 고려한 컬러 대비, 텍스트 크기, 터치 영역 설계
  - **피드백**: 사용자 행동에 대한 명확한 시각적/촉각적 피드백 제공

---

## 2. 기본 기능 구현

### 2.1 프로젝트 생성 및 기본 구조 설정

- **개발 환경 구성**:
  - Flutter SDK 및 Dart 설정
  - Android/iOS 개발 환경 준비
  - VSCode 또는 Android Studio 개발 환경 설정

- **프로젝트 구조**:
  ```
  lib/
  ├── core/
  │   ├── services/        # API 서비스, 외부 연동
  │   └── utils/           # 유틸리티 함수, 확장 기능
  ├── data/
  │   ├── models/          # 데이터 모델 클래스
  │   └── providers/       # 상태 관리 프로바이더
  ├── presentation/
  │   ├── screens/         # 화면 위젯
  │   └── widgets/         # 재사용 가능한 UI 컴포넌트
  └── app.dart             # 앱 진입점
  ```

- **기본 패키지 설정**:
  - **UI/UX**: flutter_animate, google_fonts
  - **상태 관리**: flutter_riverpod
  - **네비게이션**: go_router
  - **네트워크**: http, dio
  - **로컬 데이터**: shared_preferences, sqflite

### 2.2 메인 페이지 UI 구현

- **홈 화면 구현**:
  - 상담사 카드 리스트 표시
  - 각 카드에 상담사 아바타, 이름, 간략 설명 포함
  - 필터링 및 검색 기능 구현
  - 신규 상담사 생성 버튼 추가

- **테마 시스템 구현**:
  - 라이트/다크 모드 지원
  - 커스텀 테마 데이터 정의
  - 다이나믹 컬러 시스템 구현

- **반응형 레이아웃**:
  - 다양한 화면 크기 지원
  - LayoutBuilder 활용한 적응형 UI
  - 가로/세로 모드 대응

### 2.3 데이터 모델 클래스 정의

- **상담사 페르소나 모델**:
  ```dart
  class CounselorPersona {
    final String id;
    final String name;
    final String avatarEmoji;
    final String description;
    final List<String> specialties;
    final List<Color> gradientColors;
    final Map<String, int> personality;
    final bool isRoleplay;
    final bool isCustom;
    final String chatStyle;
    // 추가 속성들...
    
    // 팩토리 메서드 및 시리얼라이제이션 기능
  }
  ```

- **메시지 모델**:
  ```dart
  class Message {
    final String id;
    final String content;
    final DateTime timestamp;
    final MessageSender sender;
    final bool? isTyping;
    
    // 생성자 및 기능 메서드
  }

  enum MessageSender { user, counselor }
  ```

- **롤플레이 정보 모델**:
  ```dart
  class RoleplayInfo {
    final String category;
    final String scenario;
    final String goal;
    final Map<String, String> contextData;
    final bool useReferenceChat;
    final String referenceChat;
    
    // 생성자 및 유틸리티 메서드
  }
  ```

### 2.4 더미 데이터 생성 및 표시

- **기본 상담사 더미 데이터**:
  - 공감형, 분석형, 실용형, 유머형 등 다양한 특성의 상담사 프로필
  - 각 상담사별 고유 색상, 이모지, 성격 특성 설정
  - 대화 스타일 및 전문 분야 정보 포함

- **롤플레이 시나리오 더미 데이터**:
  - 면접, 연애, 비즈니스 등 다양한 상황별 롤플레이 시나리오
  - 각 시나리오별 컨텍스트 정보 및 목표 설정
  - 참조 대화 예시 포함

- **테스트 대화 데이터**:
  - 사용자와 AI 간의 샘플 대화 시퀀스
  - 다양한 상황 및 대화 스타일 반영
  - 메시지 타이밍 및 타이핑 효과 시뮬레이션

---

## 3. 네비게이션 및 데이터 전달

### 3.1 페이지 간 네비게이션 구현

- **라우팅 시스템 구현**:
  - GoRouter를 활용한 선언적 라우팅 구성
  - 중첩 라우팅을 통한 계층적 화면 구조 정의
  - 애니메이션 전환 효과 적용

- **네비게이션 패턴**:
  - 메인 화면 → 채팅 화면 이동
  - 메인 화면 → 상담사 생성/편집 화면 이동
  - 채팅 화면 내 상담사 정보 모달 표시
  - 뒤로 가기 및 홈 화면 이동 처리

- **딥 링크 지원**:
  - 특정 상담사와의 대화로 바로 이동할 수 있는 딥 링크 구현
  - 공유 기능을 통한 상담사 프로필 전달 가능

### 3.2 데이터 전달 메커니즘 구현

- **상태 관리 시스템**:
  - Riverpod을 활용한 전역 상태 관리 구현
  - 상담사 목록, 현재 대화, 설정 등 주요 상태 정의
  - 비동기 상태 처리를 위한 FutureProvider/StreamProvider 활용

- **주요 프로바이더 구현**:
  ```dart
  // 모든 상담사 목록 프로바이더
  final counselorPersonasProvider = StateNotifierProvider<CounselorNotifier, List<CounselorPersona>>((ref) {
    return CounselorNotifier();
  });

  // 특정 상담사와의 대화 메시지 프로바이더
  final chatMessagesProvider = StateNotifierProvider.family<MessageNotifier, List<Message>, String>((ref, counselorId) {
    return MessageNotifier(counselorId);
  });

  // 사용자 설정 프로바이더
  final userSettingsProvider = StateNotifierProvider<SettingsNotifier, UserSettings>((ref) {
    return SettingsNotifier();
  });
  ```

- **데이터 지속성**:
  - SharedPreferences를 활용한 기본 설정 저장
  - 로컬 SQLite 데이터베이스를 통한 대화 내역 저장
  - 복합 데이터 구조의 JSON 직렬화/역직렬화 구현

### 3.3 상세 페이지 UI 및 기능 구현

- **채팅 화면 구현**:
  - 메시지 버블 UI 컴포넌트 개발
  - 스크롤 가능한 채팅 리스트 구현
  - 타이핑 표시 애니메이션 효과
  - 메시지 전송 및 입력 UI 최적화

- **상담사 정보 모달**:
  - 성격 특성 그래프 시각화
  - 전문 분야 태그 표시
  - 상담 스타일 및 추가 정보 레이아웃

- **상담사 생성/편집 화면**:
  - 단계별 설정 프로세스 구현
  - 슬라이더 기반 성격 특성 설정 인터페이스
  - 전문 분야 선택 UI 구현
  - 유효성 검증 및 피드백 시스템

---

## 4. 고급 기능 통합

### 4.1 사용자 입력 처리 및 데이터 저장

- **입력 검증 시스템**:
  - 사용자 입력 유효성 검사
  - 에러 메시지 및 안내 UI 개선
  - 폼 데이터 처리 최적화

- **데이터 저장 구조**:
  - 채팅 내역 효율적 저장 시스템
  - 사용자 설정 데이터 관리
  - 상담사 프로필 데이터 저장소

- **데이터 백업 및 동기화**:
  - 클라우드 백업 옵션
  - 기기 간 동기화 기능
  - 데이터 마이그레이션 지원

### 4.2 UI/UX 개선 및 애니메이션 추가

- **고급 애니메이션**:
  - Flutter Animate 라이브러리 활용
  - 페이지 전환 애니메이션 커스터마이징
  - 미세 인터랙션 애니메이션 추가

- **접근성 개선**:
  - 스크린 리더 호환성 강화
  - 색상 대비 최적화
  - 키보드 네비게이션 지원

- **성능 최적화**:
  - 리스트 렌더링 최적화
  - 이미지 캐싱 및 메모리 관리
  - 애니메이션 성능 튜닝

---

## 5. API 및 외부 서비스 연동

### 5.1 REST API 또는 외부 서비스 연동

- **Gemini AI API 통합**:
  - Google의 Gemini AI API 연동
  - 프롬프트 엔지니어링을 통한 상담사 페르소나 구현
  - API 응답 파싱 및 메시지 포맷팅

- **오류 처리 및 재시도 로직**:
  - 네트워크 오류 감지 및 처리
  - 자동 재시도 메커니즘
  - 사용자 친화적인 오류 메시지

### 5.2 데이터 동기화 및 실시간 업데이트 구현

- **실시간 채팅 최적화**:
  - 메시지 전송 및 수신 프로세스 효율화
  - 타이핑 상태 실시간 업데이트
  - 대화 이력 동기화

- **백그라운드 데이터 처리**:
  - 백그라운드 작업 관리
  - 메시지 큐 시스템 구현
  - 네트워크 상태 변화에 대응

- **캐싱 전략**:
  - API 응답 캐싱
  - 오프라인 모드 지원
  - 데이터 사용량 최적화

### 5.3 에러 처리 및 예외 상황 관리

- **예외 처리 시스템**:
  - 전역 에러 핸들링 구현
  - 에러 로깅 및 분석
  - 사용자 피드백 메커니즘

- **대체 흐름 구현**:
  - API 실패 시 폴백 메커니즘
  - 오프라인 모드 대체 기능 (firebase로 업로드 시도하였다가, 현재는 로컬기반으로 실행시키도록 구성) 
  - 그레이스풀 디그레이데이션


